<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GeographicLib: Geodesics on the Ellipsoid</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="geodesic">Geodesics on the Ellipsoid </a></h1><center> Back to <a class="el" href="transversemercator.html">Transverse Mercator Projection</a>. Forward to <a class="el" href="geocentric.html">Geocentric coordinates</a>. Up to <a class="el" href="index.html#contents">Contents</a>. </center><p><a class="el" href="classGeographicLib_1_1Geodesic.html" title="Geodesic calculations">GeographicLib::Geodesic</a> and <a class="el" href="classGeographicLib_1_1GeodesicLine.html" title="A geodesic line.">GeographicLib::GeodesicLine</a> provide accurate solutions to the direct and inverse geodesic problems. The <a class="el" href="utilities.html#geod">Geod</a> utility provides an interface to these classes. <a class="el" href="classGeographicLib_1_1AzimuthalEquidistant.html" title="Azimuthal Equidistant Projection.">GeographicLib::AzimuthalEquidistant</a> implements the azimuthal equidistant projection in terms of geodesics. <a class="el" href="classGeographicLib_1_1CassiniSoldner.html" title="Cassini-Soldner Projection.">GeographicLib::CassiniSoldner</a> implements a transverse cylindrical equidistant projection in terms of geodesics. The <a class="el" href="utilities.html#equidistanttest">EquidistantTest</a> utility provides an interface to these projections.</p>
<p>References</p>
<ul>
<li>F. W. Bessel, <a href="http://adsabs.harvard.edu/abs/1825AN......4..241B">&Uuml;ber die Berechnung der geographischen L&auml;ngen und Breiten aus geod&auml;tischen Vermessungen</a>, Astron. Nachr. 4 (86), 241&ndash;254 (1826). English translation: <a href="http://arxiv.org/abs/0908.1824">arXiv:0908.1824</a>.</li>
<li>F. R. Helmert, Die Mathematischen und Physikalischen Theorieen der H&ouml;heren Geod&auml;sie, vol. 1 (Teubner, Leipzig, 1880).</li>
<li>E. B. Christoffel, Allgemeine Theorie der geod&auml;tischen Dreiecke (1868), in "Gesammelte Mathematische Abhandlungen", vol. 1, chap. 16, pp. 297&ndash;346 (Teubner, Leipzig, 1910).</li>
<li>H. F. Rainsford, <a href="http://dx.doi.org/10.1007/BF02527187">Long geodesics on the ellipsoid</a>, Bull. Geod. 37 (1), 12&ndash;22 (1955).</li>
<li>T. Vincenty, <a href="http://www.ngs.noaa.gov/PUBS_LIB/inverse.pdf">Direct and Inverse Solutions of Geodesics on the Ellipsoid with Application of Nested Equations</a>, Survey Review 23 (176), 88&ndash;93 (1975).</li>
<li>A collection of some older papers on geodesics is available at <a href="http://trac.osgeo.org/proj/wiki/GeodesicCalculations#TheHistory">http://trac.osgeo.org/proj/wiki/GeodesicCalculations#TheHistory</a></li>
</ul>
<h2><a class="anchor" id="geoddesc">
Description of algorithm</a></h2>
<p>The shortest path between two points on a ellipsoid at (<em>lat1</em>, <em>lon1</em>) and (<em>lat2</em>, <em>lon2</em>) is called the geodesic. Its length is <em>s12</em> and the geodesic from point 1 to point 2 has azimuths <em>azi1</em> and <em>azi2</em> at the two end points. (The azimuth is the heading measured clockwise from north. <em>azi2</em> is the "forward" azimuth, i.e., the heading that takes you beyond point 2 not back to point 1.) The reduced length of the geodesic, <em>m12</em>, is the rate at which the second point moves as the geodesic is rotated about the first point. Christoffel (1868) proved that this is equal to the rate at which the first point moves when the geodesic is rotated about the second point.</p>
<p>Given <em>lat1</em>, <em>lon1</em>, <em>azi1</em>, and <em>s12</em>, we can determine <em>lat2</em>, <em>lon2</em>, <em>azi2</em>, <em>m12</em>. This is the <b>direct</b> geodesic problem. (If <em>s12</em> is sufficiently large that the geodesic wraps more than halfway around the earth, there will be another geodesic between the points with a smaller <em>s12</em>.)</p>
<p>Given <em>lat1</em>, <em>lon1</em>, <em>lat2</em>, and <em>lon2</em>, we can determine <em>azi1</em>, <em>azi2</em>, <em>s12</em>, <em>m12</em>. This is the <b>inverse</b> geodesic problem. Usually, the solution to the inverse problem is unique. In cases where there are multiple solutions (all with the same <em>s12</em>, of course), all the solutions can be easily generated once a particular solution is provided.</p>
<p>The framework for solving geodesic problems on the ellipsoid was laid down by Bessel (1826) who showed how the problem may be transferred to an "auxiliary sphere" where the latitude <em>phi</em> has been replaced by the reduced latitude <em>beta</em> where tan(<em>beta</em>) = (1 - <em>f</em>) tan(<em>phi</em>). On this sphere, the geodesic is a great circle and the azimuth is the same as on the ellipsoid. However, the ellipsoidal distance is related to the great circle distance by an integral; and the ellipsoidal longitude is similarly related to the longitude on the auxiliary sphere. In the case of small <em>f</em>, Bessel developed series expansions for the integrals and provided a systematic solution to the direct problem. Helmert (1880) extended Bessel's treatment by giving an expression for the reduced length of a geodesic for the ellipsoid. The "azimuthal scale" of the azimuthal equidistant projection about point 1 is given by <em>s12/<em>m12</em>.</em> </p>
<p>The algorithms included here are based on the work of Bessel (1826) and Helmert (1880). Key points are:</p>
<ul>
<li>Extension of Bessel's method for removing half the terms in the series expansions to the longitude integral. This also accelerates the convergence of the series.</li>
<li>Inclusion of sufficient terms in the series to give accuracy at the round-off level for doubles and long doubles.</li>
<li>Reverting the distance series so that the direct problem can be solved non-iteratively.</li>
<li>Calculation of the reduced length for the geodesic.</li>
<li>Solution the inverse problem via Newton's method, using the reduced length to compute the needed derivative.</li>
</ul>
<p>Vincenty (1975) has provided algorithms for the direct and inverse geodesic problems based in the series given by Rainsford (1955) (based, in turn, on Bessel). However Vincenty's methods were designed for use on the desk calculators of that era and are not optimal (in terms of accuracy and robustness) for a general purpose computer. The distinguishing features of the algorithms presented here compared to Vincenty's are:</p>
<ul>
<li>Accuracy to close to the round-off limit (i.e., 15 nm for doubles).</li>
<li>Complete solution of the inverse problem. (Vincenty's inverse algorithm sometimes fails.)</li>
<li>Return the reduced length of the geodesic.</li>
</ul>
<p>The series expansions for the integrals are obtained using <a href="http://en.wikipedia.org/wiki/Maxima_(software)">Maxima</a>. In this release, we use a 6th-order expansions. This is sufficient to maintain accuracy for doubles for the SRMmax ellipsoid (<em>a</em> = 6400 km, <em>f</em> = 1/150). However, the preprocessor macro GEOD_ORD can be used to select any order up to 8. (If using long doubles, with a 64-bit fraction, the default order is 7.) The series is evaluated by a combination of Horner's method and Clenshaw summation. For the direct problem, we use a reversion of the series for the distance to compute the spherical arc length and thereby complete the solution without the need to iterate.</p>
<p>The Maxima code, <a href="geod.mac">geod.mac</a>, used to derive the series for the distance and longitude integrals. In addition this includes code to format the results for inclusion into C++ code. You will need to have Maxima installed to use this code. The comments at the top of <a href="geod.mac">geod.mac</a> illustrate how to run it. It takes about 10s to generate the 8th order series.</p>
<p>For the inverse problem, we rearrange the points so that the point 1 is the one closest to a pole and is in the southern hemisphere and the point 2 is to the north and east of point 1. We consider geodesics leaving point 1 with azimuth <em>alpha1</em> in [0, pi] and we determine the longitude where these geodesics first intersect the latitude = <em>lat2</em>. The longitude is an increasing function of <em>alpha1</em> and we use Newton's method to determine the value of <em>alpha1</em> for which the longitude matches <em>lon2</em>. This then gives the desired geodesic.</p>
<p>This class also returns the arc length <em>a12</em> on the auxiliary sphere and allows distances to be specified in these terms. See the -a option to <a class="el" href="utilities.html#geod">Geod</a>.</p>
<h2><a class="anchor" id="testgeod">
Test data for geodesics</a></h2>
<p>A test set a geodesics is available at</p>
<ul>
<li><a href="http://sourceforge.net/projects/geographiclib/files/testdata/GeodTest.dat.gz/download">GeodTest.dat.gz</a></li>
</ul>
<p>This is about 34 MB (compressed). This consists of a set of geodesics for the WGS84 ellipsoid. A subset of this (consisting of 1/50 of the members &mdash; about 690 kB, compressed) is available at</p>
<ul>
<li><a href="http://sourceforge.net/projects/geographiclib/files/testdata/GeodTest-short.dat.gz/download">GeodTest-short.dat.gz</a></li>
</ul>
<p>Each line of the test set gives 9 space delimited numbers</p>
<ul>
<li>latitude for point 1, <em>lat1</em> (degrees, exact)</li>
<li>longitude for point 1, <em>lon1</em> (degrees, always 0)</li>
<li>azimuth for point 1, <em>azi1</em> (clockwise from north in degrees, exact)</li>
<li>latitude for point 2, <em>lat2</em> (degrees, accurate to 10<sup>-18</sup> deg)</li>
<li>longitude for point 2, <em>lon2</em> (degrees, accurate to 10<sup>-18</sup> deg)</li>
<li>azimuth for point 2, <em>azi2</em> (degrees, accurate to 10<sup>-18</sup> deg)</li>
<li>geodesic distance from point 1 to point 2, <em>s12</em> (meters, exact)</li>
<li>arc distance on the auxiliary sphere, <em>a12</em> (degrees, accurate to 10<sup>-18</sup> deg)</li>
<li>reduced length of the geodesic, <em>m12</em> (meters, accurate to 0.1 pm)</li>
</ul>
<p>These are computed using as direct geodesic calculations with the given <em>lat1</em>, <em>lon1</em>, <em>azi1</em>, and <em>s12</em>. The distance <em>s12</em> always corresponds to an arc length <em>a12</em> &lt;= 180<sup>o</sup>, so the given geodesics give the shortest paths from point 1 to point 2. For simplicity and without loss of generality, <em>lat1</em> is chosen in [0<sup>o</sup>, 90<sup>o</sup>], <em>lon1</em> is taken to be zero, <em>azi1</em> is chosen in [0<sup>o</sup>, 180<sup>o</sup>]. Furthermore, <em>lat1</em> and <em>azi1</em> are taken to be multiples of 10<sup>-12</sup> deg and <em>s12</em> is a multiple of 0.1 um in [0 m, 20003931.4586254 m]. This results <em>lon2</em> in [0<sup>o</sup>, 180<sup>o</sup>] and <em>azi2</em> in [0<sup>o</sup>, 180<sup>o</sup>].</p>
<p>The direct calculation uses an expansion of the geodesic equations accurate to <em>f<sup>20</sup></em> (approximately 1 part in 10<sup>50</sup>) and is computed with with <a href="http://en.wikipedia.org/wiki/Maxima_(software)">Maxima</a>'s bfloats and fpprec set to 100 (so the errors in the data are probably 1/2 of the values quoted above).</p>
<p>The contents of the file are as follows:</p>
<ul>
<li>100000 entries randomly distributed</li>
<li>50000 entries which are nearly antipodal</li>
<li>50000 entries with short distances</li>
<li>50000 entries with one end near a pole</li>
<li>50000 entries with both ends near opposite poles</li>
<li>50000 entries which are nearly meridional</li>
<li>50000 entries which are nearly equatorial</li>
<li>50000 entries running between vertices (<em>azi1</em> = <em>azi2</em> = 90<sup>o</sup>)</li>
<li>50000 entries ending close to vertices</li>
</ul>
<p>(a total of 500000 entries). The values for <em>s12</em> for the geodesics running between vertices are truncated to a multiple of 0.1 pm and this is used to determine point 2.</p>
<p>This data can be fed to the <a class="el" href="utilities.html#geod">Geod</a> utility as follows</p>
<ul>
<li>Direct from point 1: <div class="fragment"><pre class="fragment">
  gunzip -c GeodTest.dat.gz | cut -d' ' -f1,2,3,7 | ./Geod
</pre></div> This should yield columns 4, 5, 6, and 9 of the test set.</li>
<li>Direct from point 2: <div class="fragment"><pre class="fragment">
  gunzip -c GeodTest.dat.gz | cut -d' ' -f4,5,6,7 |
  sed "s/ \([^ ]*$\)/ -\1/" | ./Geod
</pre></div> (The sed command negates the distance.) This should yield columns 1, 2, and 3, and the negative of column 9 of the test set.</li>
<li>Inverse between points 1 and 2: <div class="fragment"><pre class="fragment">
  gunzip -c GeodTest.dat.gz | cut -d' ' -f1,2,4,5 | ./Geod -i
</pre></div> This should yield columns 3, 6, 7, and 9 of the test set.</li>
</ul>
<p>Add, e.g., "-p 6", to the call to Geod to change the precision of the output. Adding "-f" causes Geod to print all 9 fields specifying the geodesic (in the same order as the test set).</p>
<h2><a class="anchor" id="geoderrors">
Accuracy of geodesic calculation</a></h2>
<p>We regard all the test data as "exact". For each member of the test set, 6 error distances are computed. (The direct problem is solved from both ends and the maximum of the errors is used.)</p>
<ol type="1">
<li>The error in the position of point 2 for the direct problem.</li>
<li>Error in the direction of geodesic at point 2 for the direct problem scaled by the major radius. (This is the direction in 3D space to allow canceling variations in longitude and azimuth near the poles.)</li>
<li>Error in m12 for the direct problem.</li>
<li>Error in s12 for the inverse problem.</li>
<li>Error in the azimuths at points 1 and 2 for the inverse problem scaled by m12.</li>
<li>Consistency of the azimuths at points 1 and 2 for the inverse problem. Compute geodesic from each endpoint using the computed azimuths; compare positions on each geodesic at midpoint (for long geodesics) or a distance equal to the major radius beyond each end of the geodesic (for short geodesics).</li>
</ol>
<p>The last check verifies that <em>azi1</em> and <em>azi2</em> returned by the inverse solution correspond to the same path and is important, e.g., when point 1 and point 2 are near opposite poles. To guard against a canceling error, the calculations in last error estimate use a long double version of the direct geodesic calculation (which is about 2000 times more accurate than the double version). The maximum of the resulting errors in less than 15 nm for the double version and 7 pm for the long double version.</p>
<h2><a class="anchor" id="geodseries">
Expansions for geodesics</a></h2>
<p>We give here the series expansions for the various geodesic integrals valid to order <em>f</em><sup>8</sup>.</p>
<p>In the formulas below ^ indicates exponentiation (<em>f^3</em> = <em>f*<em>f*<em>f</em>)</em> and</em> / indicates real division (3/5 = 0.6). The equations need to be converted to Horner form, but are here left in expanded form so that they can be easily truncated to lower order. These expansions were obtained using the the Maxima code, <a href="geod.mac">geod.mac</a>.</p>
<p>The series expanded to order <em>f</em><sup>30</sup> are given in <a href="geodseries30.html">geodseries30.html</a>.</p>
<p>In the expansions below, we have</p>
<ul>
<li><em>alpha<sub>0</sub></em> is the azimuth at the equator crossing</li>
<li><em>lambda</em> is the longitude measured from the equator crossing</li>
<li><em>omega</em> is the spherical longitude</li>
<li><em>sigma</em> is the spherical arc length</li>
<li><em>f</em> is the flattening</li>
<li><em>e<sup>2</sup></em> = <em>f</em> (2 - <em>f</em>)</li>
<li><em>e'<sup>2</sup></em> = <em>e<sup>2</sup>/</em>(1 - <em>e<sup>2</sup></em>)</li>
<li><em>k<sup>2</sup></em> = <em>e'<sup>2</sup></em> cos<sup>2</sup> <em>alpha<sub>0</sub></em> = 4 <em>eps</em> / (1 - <em>eps</em>)<sup>2</sup></li>
<li><em>del</em> = (<em>f</em> - <em>eps</em>) / (1 - <em>eps</em>)</li>
<li><em>nu</em> = <em>eps</em> / <em>del</em> </li>
</ul>
<p>The formula for distance is</p>
<p>&nbsp; &nbsp; <em>s/<em>b</em> =</em> <em>I1</em>(<em>sigma</em>)</p>
<p>where</p>
<p>&nbsp; &nbsp; <em>I1</em>(<em>sigma</em>) = <em>A1</em> (<em>sigma</em> + <em>B1</em>(<em>sigma</em>))<br/>
 &nbsp; &nbsp; <em>B1</em>(<em>sigma</em>) = sum<sub><em>j</em> = 1</sub> <em>C1<sub>j</sub></em> sin(2 <em>j</em> <em>sigma</em>)</p>
<p>and</p>
<div class="fragment"><pre class="fragment">
A1 = (1 + 1/4 * eps^2
        + 1/64 * eps^4
        + 1/256 * eps^6
        + 25/16384 * eps^8) / (1 - eps);
</pre></div><div class="fragment"><pre class="fragment">
C1[1] = - 1/2 * eps
        + 3/16 * eps^3
        - 1/32 * eps^5
        + 19/2048 * eps^7;
C1[2] = - 1/16 * eps^2
        + 1/32 * eps^4
        - 9/2048 * eps^6
        + 7/4096 * eps^8;
C1[3] = - 1/48 * eps^3
        + 3/256 * eps^5
        - 3/2048 * eps^7;
C1[4] = - 5/512 * eps^4
        + 3/512 * eps^6
        - 11/16384 * eps^8;
C1[5] = - 7/1280 * eps^5
        + 7/2048 * eps^7;
C1[6] = - 7/2048 * eps^6
        + 9/4096 * eps^8;
C1[7] = - 33/14336 * eps^7;
C1[8] = - 429/262144 * eps^8;
</pre></div><p>The function <em>tau</em>(<em>sigma</em>) = <em>s/</em>(<em>b</em> <em>A1</em>) = <em>sigma</em> + <em>B1</em>(<em>sigma</em>) may be inverted by series reversion giving</p>
<p>&nbsp; &nbsp; <em>sigma</em>(<em>tau</em>) = <em>tau</em> + sum<sub><em>j</em> = 1</sub> <em>C1'<sub>j</sub></em> sin(2 <em>j</em> <em>tau</em>)</p>
<p>where</p>
<div class="fragment"><pre class="fragment">
C1'[1] = + 1/2 * eps
         - 9/32 * eps^3
         + 205/1536 * eps^5
         - 4879/73728 * eps^7;
C1'[2] = + 5/16 * eps^2
         - 37/96 * eps^4
         + 1335/4096 * eps^6
         - 86171/368640 * eps^8;
C1'[3] = + 29/96 * eps^3
         - 75/128 * eps^5
         + 2901/4096 * eps^7;
C1'[4] = + 539/1536 * eps^4
         - 2391/2560 * eps^6
         + 1082857/737280 * eps^8;
C1'[5] = + 3467/7680 * eps^5
         - 28223/18432 * eps^7;
C1'[6] = + 38081/61440 * eps^6
         - 733437/286720 * eps^8;
C1'[7] = + 459485/516096 * eps^7;
C1'[8] = + 109167851/82575360 * eps^8;
</pre></div><p>The reduced length is given by</p>
<p>&nbsp; &nbsp; <em>m/<em>b</em> =</em> sqrt(1 + <em>k<sup>2</sup></em> sin<sup>2</sup><em>sigma<sub>2</sub></em>) cos <em>sigma<sub>1</sub></em> sin <em>sigma<sub>2</sub></em> <br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - sqrt(1 + <em>k<sup>2</sup></em> sin<sup>2</sup><em>sigma<sub>1</sub></em>) sin <em>sigma<sub>1</sub></em> cos <em>sigma<sub>2</sub></em> <br/>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - cos <em>sigma<sub>1</sub></em> cos <em>sigma<sub>2</sub></em> (<em>J</em>(<em>sigma<sub>2</sub></em>) - <em>J</em>(<em>sigma<sub>1</sub></em>))</p>
<p>where</p>
<p>&nbsp; &nbsp; <em>J</em>(<em>sigma</em>) = <em>I1</em>(<em>sigma</em>) - <em>I2</em>(<em>sigma</em>)<br/>
 &nbsp; &nbsp; <em>I2</em>(<em>sigma</em>) = <em>A2</em> (<em>sigma</em> + <em>B2</em>(<em>sigma</em>))<br/>
 &nbsp; &nbsp; <em>B2</em>(<em>sigma</em>) = sum<sub><em>j</em> = 1</sub> <em>C2<sub>j</sub></em> sin(2 <em>j</em> <em>sigma</em>)</p>
<div class="fragment"><pre class="fragment">
A2 = (1 + 1/4 * eps^2
        + 9/64 * eps^4
        + 25/256 * eps^6
        + 1225/16384 * eps^8) * (1 - eps);
</pre></div><div class="fragment"><pre class="fragment">
C2[1] = + 1/2 * eps
        + 1/16 * eps^3
        + 1/32 * eps^5
        + 41/2048 * eps^7;
C2[2] = + 3/16 * eps^2
        + 1/32 * eps^4
        + 35/2048 * eps^6
        + 47/4096 * eps^8;
C2[3] = + 5/48 * eps^3
        + 5/256 * eps^5
        + 23/2048 * eps^7;
C2[4] = + 35/512 * eps^4
        + 7/512 * eps^6
        + 133/16384 * eps^8;
C2[5] = + 63/1280 * eps^5
        + 21/2048 * eps^7;
C2[6] = + 77/2048 * eps^6
        + 33/4096 * eps^8;
C2[7] = + 429/14336 * eps^7;
C2[8] = + 6435/262144 * eps^8;
</pre></div><p>The longitude is given in terms of the spherical longitude by</p>
<p>&nbsp; &nbsp; <em>lambda</em> = <em>omega</em> - <em>f</em> sin <em>alpha<sub>0</sub></em> <em>I3</em>(<em>sigma</em>)</p>
<p>where</p>
<p>&nbsp; &nbsp; <em>I3</em>(<em>sigma</em>) = <em>A3</em> (<em>sigma</em> + <em>B3</em>(<em>sigma</em>))<br/>
 &nbsp; &nbsp; <em>B3</em>(<em>sigma</em>) = sum<sub><em>j</em> = 1</sub> <em>C3<sub>j</sub></em> sin(2 <em>j</em> <em>sigma</em>)</p>
<p>and</p>
<div class="fragment"><pre class="fragment">
A3 = (2 - f) / (2 - del) * (1
        - 1/16 * nu^2 * del^3
        - 1/64 * nu^4 * del^4
        + 1/64 * nu^2 * del^5
        + (1/64 * nu^2 + 1/64 * nu^4 - 1/128 * nu^6) * del^6
        + (3/256 * nu^2 + 7/1024 * nu^4 + 15/2048 * nu^6) * del^7);
</pre></div><div class="fragment"><pre class="fragment">
C3[1] = + 1/4 * eps
        - 1/8 * eps*del
        - (1/16 + 1/64 * nu^2) * eps*del^2
        - (1/32 + 1/128 * nu^2) * eps*del^3
        - (1/64 - 1/128 * nu^2 + 1/128 * nu^4) * eps*del^4
        - (1/128 - 1/128 * nu^2 - 3/1024 * nu^4) * eps*del^5
        - (1/256 - 5/1024 * nu^2 - 5/1024 * nu^4 + 61/16384 * nu^6) * eps*del^6;
C3[2] = + 1/16 * eps^2
        - 3/64 * eps^2*del
        - (1/64 + 1/128 * nu^2) * eps^2*del^2
        - 1/256 * eps^2*del^3
        + (5/1024 * nu^2 - 7/2048 * nu^4) * eps^2*del^4
        + (1/1024 + 3/1024 * nu^2 + 37/16384 * nu^4) * eps^2*del^5;
C3[3] = + 5/192 * eps^3
        - 3/128 * eps^3*del
        - (1/192 + 7/1536 * nu^2) * eps^3*del^2
        + 1/768 * nu^2 * eps^3*del^3
        + (1/1024 + 35/12288 * nu^2 - 91/49152 * nu^4) * eps^3*del^4;
C3[4] = + 7/512 * eps^4
        - 7/512 * eps^4*del
        - (1/512 + 3/1024 * nu^2) * eps^4*del^2
        + (5/8192 + 23/16384 * nu^2) * eps^4*del^3;
C3[5] = + 21/2560 * eps^5
        - 9/1024 * eps^5*del
        - (3/4096 + 33/16384 * nu^2) * eps^5*del^2;
C3[6] = + 11/2048 * eps^6
        - 99/16384 * eps^6*del;
C3[7] = + 429/114688 * eps^7;
</pre></div><h2><a class="anchor" id="geodmisc">
Miscellaneous information on geodesics</a></h2>
<p>When either point is at a pole, the azimuth is defined by keeping the longitude fixed and writing <em>lat</em> = 90 - <em>eps</em> or -90 + <em>eps</em> and taking the limit <em>eps</em> -&gt; 0 from above.</p>
<p>The following prescription allows you to ascertain when there are multiple solutions to the inverse problem and to generate the complete set.</p>
<ul>
<li><em>lat1</em> = <em>-lat2</em> (with neither at a pole). If <em>azi1</em> = <em>azi2</em>, the geodesic is unique. Otherwise there are two geodesics and the second one is obtained by setting [<em>azi1</em>, <em>azi2</em>] = [<em>azi2</em>, <em>azi1</em>]. (This occurs when the longitude difference is near +/- 180<sup>o</sup> for oblate ellipsoids.)</li>
<li><em>lon2</em> = <em>lon1</em> +/- 180<sup>o</sup> (with neither at a pole). If <em>azi1</em> = 0<sup>o</sup> or +/- 180<sup>o</sup>, the geodesic is unique. Otherwise there are two geodesics and the second one is obtained by setting [<em>azi1</em>, <em>azi2</em>] = [-<em>azi1</em>, -<em>azi2</em>]. (This occurs when the <em>lat2</em> is near -<em>lat1</em> for prolate ellipsoids.)</li>
<li>Points 1 and 2 at opposite poles. There are infinitely many geodesics which can be generated by setting [<em>azi1</em>, <em>azi2</em>] = [<em>azi1</em>, <em>azi2</em>] + [<em>d</em>, -<em>d</em>], for arbitrary <em>d</em>. (For spheres, this prescription applies when points 1 and 2 are antipodal.)</li>
<li><em>s12</em> = 0 (coincident points). There are infinitely many geodesics which can be generated by setting [<em>azi1</em>, <em>azi2</em>] = [<em>azi1</em>, <em>azi2</em>] + [<em>d</em>, <em>d</em>], for arbitrary <em>d</em>.</li>
</ul>
<p>A rather large fraction of the code in <a class="el" href="classGeographicLib_1_1Geodesic.html" title="Geodesic calculations">GeographicLib::Geodesic</a> deals merely with the spherical trigonometry required to do great circle calculations. When high accuracy is required, care has to be taken to use stable methods for computing angles. Typically, we represent angles internally with the pair [sin(<em>theta</em>), cos(<em>theta</em>)]. This expands the number of representable angles by about 4; in particular, it allows angles very close to all the cardinal points to be resolved. We use expressions for sin(<em>theta</em>) and cos(<em>theta</em>) which avoid large cancellations. Having a comprehensive test set as described in <a class="el" href="geodesic.html#testgeod">Test data for geodesics</a> helps to identify problems. This representation allows input arguments which are multiples of 90<sup>o</sup> to be represented exactly.</p>
<p>The code for the inverse treats equatorial and meridional geodesics specially. All other case are handled by the same code (implementing Newton's method) with tests to select appropriate starting guess in difference regimes. Specifying a zero inverse flattening in Geodesic constructor is equivalent to zero flattening (i.e., a sphere). The method accommodates this case without any special coding.</p>
<p>In order to limits the enumeration of cases, the inverse problem is brought to a canonical form by interchanging the points and changing the signs of the coordinates. The effect of these changes are undone at the end by applying sign changes to the final calls to atan2 to give the azimuths.</p>
<p>The derivative needed for Newton's method for the inverse problem is given in terms of the reduced length. The reduced length can also be used to apply Newton's method to solve problems such as finding the distance between a point and a geodesic line.</p>
<p>Convergence failures with Newton's method for the inverse problem is signaled by negating the distance (and the arc distance and reduced length) and by reversing the azimuths. This convention was chosen as it allows both detection of the problem and subsequent use of the values (assuming that they are approximately correct). It is expected that the method converges for all models of the earth and for any two input points. Please report all cases where this does not happen.</p>
<p>Geographic coordinates which are close to zero are quantized (by adding and subtracting 1/16 deg). This allows certain cases of underflow to be avoided. This limits the accuracy to which coordinates can be specified to 0.7 pm. This should not be a problem since the overall accuracy of the algorithms is only 15 nm.</p>
<p>You can specify a <em>negative</em> flattening to get a prolate ellipsoid. The rule is that <em>b</em> is the radius of the axis of symmetry (the polar radius), that <em>a</em> is the equatorial radius, and that <em>b</em> = <em>a</em> (1 - <em>f</em>). The direct solution needed no modification. The inverse solution required a generalization in the way starting points for Newton's method are chosen; in addition a test are added to the case when the endpoints are on the same meridian to determine if a shorter non-meridional geodesic exists.</p>
<p>Most planets and satellites are approximated by oblate ellipsoids. However, satellites whose rotation frequency is tidally locked to a month may be prolate (as example is Saturn's moon, Tethys). Such satellites are typically considerably more eccentric that the earth and it may be necessary to increase the order of the series used in order to maintain accuracy.</p>
<p>GeodesicLine::Position provides a way of doing a series of direct calculations for a single geodesic. This is about 2.1 times faster than calling Geodesic::Direct. A speed-up by a further factor of 1.6 is obtained with the direct calculation if the distance is expressed in terms of the spherical arc length.</p>
<p>On a 2.66 GHz Intel machine (g++, version 4.4.0, -O3), timings are as follows:</p>
<ul>
<li>Geodesic::Direct 0.96 us</li>
<li>GeodesicLine::Position 0.45 us (arcmode = false)</li>
<li>GeodesicLine::Position 0.29 us (arcmode = true)</li>
<li>Geodesic::Inverse 2.8 us</li>
</ul>
<p>The timing for Geodesic::Inverse is a mean. Individual calls may take a few times longer because of the need to do additional Newton iterations. Mean number of Newton iterations is about 3, but this increases (rarely) to 16 with some values of the arguments.</p>
<p>Future work:</p>
<ul>
<li>More documentation.</li>
</ul>
<center> Back to <a class="el" href="transversemercator.html">Transverse Mercator Projection</a>. Forward to <a class="el" href="geocentric.html">Geocentric coordinates</a>. Up to <a class="el" href="index.html#contents">Contents</a>. </center> </div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 21 Jul 2010 for GeographicLib by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
